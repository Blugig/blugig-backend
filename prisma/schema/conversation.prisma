model Conversation {
    id                String           @id @default(uuid())
    conversation_type ConversationType // admin or freelancer

    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    // User (always present)
    user_id Int
    user    User @relation(fields: [user_id], references: [id])

    // Either admin OR freelancer (never both)
    admin_id Int?
    admin    Admin? @relation(fields: [admin_id], references: [id])

    freelancer_id Int?
    freelancer    Freelancer? @relation("FreelancerConversation", fields: [freelancer_id], references: [id])

    // conversation always for a job
    job_id Int? @unique
    job    Job? @relation("JobConversation", fields: [job_id], references: [id], onDelete: Cascade)

    messages Message[]

    last_seen_message_id Int?
    latest_message_id    Int?     @unique
    latest_message       Message? @relation("LatestMessage", fields: [latest_message_id], references: [id])
    unread_count         Int?     @default(0)

    @@unique([user_id, admin_id, job_id])
    @@unique([user_id, freelancer_id, job_id])
}

enum ConversationType {
    admin
    freelancer
}

enum MessageType {
    TEXT
    MEDIA
    OFFER
}

model Message {
    id           Int         @id @default(autoincrement())
    body         String?
    time         DateTime    @default(now())
    media_url    String?
    media_type   String?
    message_type MessageType @default(TEXT)
    is_read      Boolean     @default(false)

    offer_id Int?
    offer    Offer? @relation(fields: [offer_id], references: [id])

    conversation_id String
    conversation    Conversation @relation(fields: [conversation_id], references: [id])

    sender_user_id Int?
    sender_user    User? @relation(fields: [sender_user_id], references: [id])

    sender_admin_id Int?
    sender_admin    Admin? @relation(fields: [sender_admin_id], references: [id])

    // Freelancer message support
    sender_freelancer_id Int?
    sender_freelancer    Freelancer? @relation("FreelancerMessage", fields: [sender_freelancer_id], references: [id])

    Conversation_latest_message Conversation? @relation("LatestMessage")
}
